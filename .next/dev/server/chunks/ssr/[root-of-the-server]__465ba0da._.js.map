{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Hani/ForesterSwap/pages/login.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport Link from \"next/link\";\r\nimport { motion } from \"framer-motion\";\r\nimport { signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged } from \"firebase/auth\";\r\nimport { auth } from \"@/lib/firebase\";\r\n\r\nexport default function Login() {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [showResendVerification, setShowResendVerification] = useState(false);\r\n  const [verificationResent, setVerificationResent] = useState(false);\r\n  const router = useRouter();\r\n\r\n  // Redirect if already logged in\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\r\n      if (currentUser) {\r\n        router.push('/');\r\n      }\r\n    });\r\n    return () => unsubscribe();\r\n  }, [router]);\r\n\r\n  async function handleLogin(e) {\r\n    e.preventDefault();\r\n    setError(\"\");\r\n    setLoading(true);\r\n    setShowResendVerification(false);\r\n\r\n    try {\r\n      // Sign in with Firebase Auth (client-side)\r\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n      \r\n      // Reload user to get latest verification status from server\r\n      await userCredential.user.reload();\r\n      const refreshedUser = auth.currentUser;\r\n      \r\n      // Check if email is verified\r\n      if (!refreshedUser || !refreshedUser.emailVerified) {\r\n        setError(\"Please verify your email address before logging in. Check your inbox for the verification link.\");\r\n        setShowResendVerification(true);\r\n        // Sign out the user since they haven't verified\r\n        await auth.signOut();\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Redirect to home after successful login\r\n      router.push(\"/rides\");\r\n    } catch (err) {\r\n      setError(err.message || \"Login failed\");\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleResendVerification() {\r\n    setError(\"\");\r\n    setVerificationResent(false);\r\n    \r\n    try {\r\n      // Sign in temporarily to get the user object\r\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n      \r\n      // Send verification email\r\n      await sendEmailVerification(userCredential.user);\r\n      setVerificationResent(true);\r\n      \r\n      // Sign out again\r\n      await auth.signOut();\r\n    } catch (err) {\r\n      setError(\"Failed to resend verification email. Please try again.\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\" flex items-center justify-center bg-[#171717] py-12 px-4 custom-app-layout-mobile\"  style={{minHeight:\"80vh\"}} >\r\n      <motion.div \r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.6 }}\r\n        className=\"bg-[#171717] border border-white/10 p-8 rounded-2xl shadow-xl w-full max-w-md\" \r\n        style={{alignSelf:\"center\"}} \r\n      >\r\n        <div className=\"text-center mb-8\">\r\n          <Link href=\"/\" className=\"inline-block mb-4\">\r\n            <h1 className=\"text-3xl font-bold text-white\" >Welcome Back</h1>\r\n          </Link>\r\n          <p className=\"text-gray-400\" style={{marginBottom:\"6vh\"}}>Sign in to continue</p>\r\n        </div>\r\n\r\n        <form onSubmit={handleLogin} className=\"space-y-5\">\r\n          {error && (\r\n            <div className=\"bg-red-500/10 border border-red-500/30 text-red-400 px-4 py-3 rounded-xl text-sm\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {verificationResent && (\r\n            <div className=\"bg-green-500/10 border border-green-500/30 text-green-400 px-4 py-3 rounded-xl text-sm\">\r\n              Verification email sent! Please check your inbox.\r\n            </div>\r\n          )}\r\n\r\n          <div>\r\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n              Email Address\r\n            </label>\r\n            <input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              required\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              className=\"input-field\"\r\n              placeholder=\"you@example.com\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n              Password\r\n            </label>\r\n            <input\r\n              id=\"password\"\r\n              type=\"password\"\r\n              required\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              className=\"input-field\"\r\n              placeholder=\"••••••••\"\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            style={{height:\"5vh\",marginTop:\"3vh\"}}\r\n            disabled={loading}\r\n            className=\"w-full py-3 px-4 bg-gradient-to-r from-primary to-accent hover:from-primary-dark hover:to-primary text-white font-semibold rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {loading ? \"Signing in...\" : \"Sign In\"}\r\n          </button>\r\n\r\n          {showResendVerification && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleResendVerification}\r\n              className=\"w-full py-3 px-4 bg-white/10 hover:bg-white/20 text-white font-semibold rounded-xl transition-all border border-white/10\"\r\n            >\r\n              Resend Verification Email\r\n            </button>\r\n          )}\r\n        </form>\r\n\r\n        <div className=\"mt-6 text-center\" style={{marginBottom:\"1vh\"}}>\r\n          <p className=\"text-gray-400\">\r\n            Don't have an account?{\" \"}\r\n            <Link href=\"/signup\" className=\"text-primary hover:text-primary-light font-semibold transition-colors\">\r\n              Sign up\r\n            </Link>\r\n          </p>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}